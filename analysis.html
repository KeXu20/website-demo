<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Lab 03 - Using Propensity Scores</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">This is an example!</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="analysis.html">Analysis</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/KeXu20">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Lab 03 - Using Propensity Scores</h1>

</div>


<pre class="r"><code>library(tidyverse)
library(smd)
library(gtsummary)
library(broom)
library(survey)</code></pre>
<div id="exercise-1" class="section level2">
<h2>Exercise 1</h2>
<pre class="r"><code>coffee_df = read.csv(&quot;coffee_town_df.csv&quot;)
head(coffee_df)</code></pre>
<pre><code>##   coffee_town cups_of_coffee      age  job smoke
## 1           1              0 12.12064 none never
## 2           0              0 14.55093 none never
## 3           1              0 11.49311 none never
## 4           0              1 18.78584 easy never
## 5           0              0 14.98852 none never
## 6           1              0 11.53859 none never</code></pre>
<p>This dataset has 5 variables: coffee_town, cups_of_coffee, age, job, smoke.<br />
‘coffee_town’, ‘job’ and ‘smoke’ are categorical variable. ‘cups_of_coffee’ is continuous variable.</p>
<pre class="r"><code>nrow(coffee_df)</code></pre>
<pre><code>## [1] 1100</code></pre>
<p>The dataset has 1100 observations.</p>
<pre class="r"><code>sum(coffee_df$coffee_town)</code></pre>
<pre><code>## [1] 113</code></pre>
<p>113 observations are in exposed group.<br />
And this dataset has no missing data.</p>
</div>
<div id="exercise-2" class="section level2">
<h2>Exercise 2</h2>
<pre class="r"><code>coffee_df %&gt;%
  tbl_summary(
    by = coffee_town,
    include = c(
      &quot;age&quot;,
      &quot;job&quot;,
      &quot;smoke&quot;
    )
  ) %&gt;%
  add_overall()</code></pre>
<div id="rjptrasdtw" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#rjptrasdtw .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rjptrasdtw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rjptrasdtw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rjptrasdtw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rjptrasdtw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rjptrasdtw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rjptrasdtw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rjptrasdtw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rjptrasdtw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rjptrasdtw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rjptrasdtw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rjptrasdtw .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#rjptrasdtw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rjptrasdtw .gt_from_md > :first-child {
  margin-top: 0;
}

#rjptrasdtw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rjptrasdtw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rjptrasdtw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rjptrasdtw .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rjptrasdtw .gt_row_group_first td {
  border-top-width: 2px;
}

#rjptrasdtw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rjptrasdtw .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rjptrasdtw .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rjptrasdtw .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rjptrasdtw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rjptrasdtw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rjptrasdtw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rjptrasdtw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rjptrasdtw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rjptrasdtw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rjptrasdtw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rjptrasdtw .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rjptrasdtw .gt_left {
  text-align: left;
}

#rjptrasdtw .gt_center {
  text-align: center;
}

#rjptrasdtw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rjptrasdtw .gt_font_normal {
  font-weight: normal;
}

#rjptrasdtw .gt_font_bold {
  font-weight: bold;
}

#rjptrasdtw .gt_font_italic {
  font-style: italic;
}

#rjptrasdtw .gt_super {
  font-size: 65%;
}

#rjptrasdtw .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#rjptrasdtw .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rjptrasdtw .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#rjptrasdtw .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#rjptrasdtw .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Overall</strong>, N = 1,100<sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>0</strong>, N = 987<sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>1</strong>, N = 113<sup class="gt_footnote_marks">1</sup></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">age</td>
<td class="gt_row gt_center">39 (34, 44)</td>
<td class="gt_row gt_center">39 (34, 43)</td>
<td class="gt_row gt_center">49 (14, 52)</td></tr>
    <tr><td class="gt_row gt_left">job</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">easy</td>
<td class="gt_row gt_center">760 (69%)</td>
<td class="gt_row gt_center">707 (72%)</td>
<td class="gt_row gt_center">53 (47%)</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">hard</td>
<td class="gt_row gt_center">212 (19%)</td>
<td class="gt_row gt_center">200 (20%)</td>
<td class="gt_row gt_center">12 (11%)</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">none</td>
<td class="gt_row gt_center">128 (12%)</td>
<td class="gt_row gt_center">80 (8.1%)</td>
<td class="gt_row gt_center">48 (42%)</td></tr>
    <tr><td class="gt_row gt_left">smoke</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">current</td>
<td class="gt_row gt_center">55 (5.0%)</td>
<td class="gt_row gt_center">53 (5.4%)</td>
<td class="gt_row gt_center">2 (1.8%)</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">former</td>
<td class="gt_row gt_center">64 (5.8%)</td>
<td class="gt_row gt_center">60 (6.1%)</td>
<td class="gt_row gt_center">4 (3.5%)</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">never</td>
<td class="gt_row gt_center">981 (89%)</td>
<td class="gt_row gt_center">874 (89%)</td>
<td class="gt_row gt_center">107 (95%)</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><sup class="gt_footnote_marks">1</sup> Median (IQR); n (%)</td>
    </tr>
  </tfoot>
</table>
</div>
<p>From this table, we can see that,<br />
72% of the people who don’t live in coffee town have easy job, 47% for the people who live in coffee town have easy job.<br />
42% of the people who live in coffee town don’t have job, which is much bigger proportion than the people who don’t live in the coffee town. The median age in the exposure group is 49 which is older than the control group 39.</p>
</div>
<div id="exercise-3" class="section level2">
<h2>Exercise 3</h2>
<pre class="r"><code>coffee_df_ps1 = glm(coffee_town ~ age + smoke + job,
    data = coffee_df,
    family = binomial()) %&gt;%
  augment(type.predict = &quot;response&quot;,
          data = coffee_df)
head(coffee_df_ps1)</code></pre>
<pre><code>## # A tibble: 6 × 11
##   coffee_town cups_of_coffee   age job   smoke .fitted .resid .std.resid    .hat
##         &lt;int&gt;          &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;
## 1           1              0  12.1 none  never  0.295   1.56       1.57  0.0114 
## 2           0              0  14.6 none  never  0.313  -0.866     -0.871 0.0103 
## 3           1              0  11.5 none  never  0.291   1.57       1.58  0.0117 
## 4           0              1  18.8 easy  never  0.0368 -0.274     -0.274 0.00291
## 5           0              0  15.0 none  never  0.316  -0.872     -0.876 0.0101 
## 6           1              0  11.5 none  never  0.291   1.57       1.58  0.0117 
## # … with 2 more variables: .sigma &lt;dbl&gt;, .cooksd &lt;dbl&gt;</code></pre>
<pre class="r"><code>coffee_df_ps2 &lt;- coffee_df_ps1 %&gt;%
  tidyr::pivot_wider(names_from = coffee_town, 
                     values_from = .fitted, 
                     names_prefix = &quot;coffee_town_p&quot;)</code></pre>
<pre class="r"><code>library(ggplot2)
ggplot(coffee_df_ps1, 
       aes(x = .fitted, 
           fill = as.factor(coffee_town))) +
  geom_histogram(bins = 30)+ 
  labs(
    fill = &quot;Live in coffee town\n(1 = Yes, 0 = No)&quot;,
    x = &quot;propensity score&quot;)</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>We can observe that the group that is not live in coffee town is significantly larger than the group that is live in coffee town. Most of the people who live in coffee town have propensity scores in the range (0, 0.34), indicating that they aren’t likely live in the coffee town.</p>
</div>
<div id="exercise-4" class="section level2">
<h2>Exercise 4</h2>
<pre class="r"><code>coffee_df_ps1 &lt;- coffee_df_ps1 %&gt;%
  mutate(
    w_ato = (1-.fitted)*coffee_town +.fitted*(1-coffee_town)
  )</code></pre>
<p>The weight I’m going to use is ATO. Using this weight is to create new population in which two groups have similar distribution and good variance, which made an “equipoise” population. Then use this new weighted data to compute average treatment effect.</p>
</div>
<div id="exercise-5" class="section level2">
<h2>Exercise 5</h2>
<pre class="r"><code>svy_des = svydesign(
  ids = ~ 1,
  data = coffee_df_ps1,
  weights = ~ w_ato
)</code></pre>
<pre class="r"><code>svy_des %&gt;%
  tbl_svysummary(
    by = coffee_town,
    include = c(
      &quot;age&quot;,
      &quot;job&quot;,
      &quot;smoke&quot;
    )
  ) %&gt;%
  add_overall()</code></pre>
<div id="nklvarivsu" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#nklvarivsu .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#nklvarivsu .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nklvarivsu .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#nklvarivsu .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#nklvarivsu .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nklvarivsu .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nklvarivsu .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#nklvarivsu .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#nklvarivsu .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#nklvarivsu .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#nklvarivsu .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#nklvarivsu .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#nklvarivsu .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#nklvarivsu .gt_from_md > :first-child {
  margin-top: 0;
}

#nklvarivsu .gt_from_md > :last-child {
  margin-bottom: 0;
}

#nklvarivsu .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#nklvarivsu .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#nklvarivsu .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#nklvarivsu .gt_row_group_first td {
  border-top-width: 2px;
}

#nklvarivsu .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nklvarivsu .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#nklvarivsu .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#nklvarivsu .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nklvarivsu .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nklvarivsu .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#nklvarivsu .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#nklvarivsu .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nklvarivsu .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nklvarivsu .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nklvarivsu .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nklvarivsu .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nklvarivsu .gt_left {
  text-align: left;
}

#nklvarivsu .gt_center {
  text-align: center;
}

#nklvarivsu .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#nklvarivsu .gt_font_normal {
  font-weight: normal;
}

#nklvarivsu .gt_font_bold {
  font-weight: bold;
}

#nklvarivsu .gt_font_italic {
  font-style: italic;
}

#nklvarivsu .gt_super {
  font-size: 65%;
}

#nklvarivsu .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#nklvarivsu .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#nklvarivsu .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#nklvarivsu .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#nklvarivsu .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Overall</strong>, N = 182<sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>0</strong>, N = 91<sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>1</strong>, N = 91<sup class="gt_footnote_marks">1</sup></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">age</td>
<td class="gt_row gt_center">41 (20, 50)</td>
<td class="gt_row gt_center">39 (34, 43)</td>
<td class="gt_row gt_center">50 (14, 52)</td></tr>
    <tr><td class="gt_row gt_left">job</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">easy</td>
<td class="gt_row gt_center">96 (52%)</td>
<td class="gt_row gt_center">48 (52%)</td>
<td class="gt_row gt_center">48 (52%)</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">hard</td>
<td class="gt_row gt_center">22 (12%)</td>
<td class="gt_row gt_center">11 (12%)</td>
<td class="gt_row gt_center">11 (12%)</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">none</td>
<td class="gt_row gt_center">65 (35%)</td>
<td class="gt_row gt_center">32 (35%)</td>
<td class="gt_row gt_center">32 (35%)</td></tr>
    <tr><td class="gt_row gt_left">smoke</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">current</td>
<td class="gt_row gt_center">4 (2.1%)</td>
<td class="gt_row gt_center">2 (2.1%)</td>
<td class="gt_row gt_center">2 (2.1%)</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">former</td>
<td class="gt_row gt_center">7 (4.1%)</td>
<td class="gt_row gt_center">4 (4.1%)</td>
<td class="gt_row gt_center">4 (4.1%)</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">never</td>
<td class="gt_row gt_center">171 (94%)</td>
<td class="gt_row gt_center">86 (94%)</td>
<td class="gt_row gt_center">86 (94%)</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><sup class="gt_footnote_marks">1</sup> Median (IQR); n (%)</td>
    </tr>
  </tfoot>
</table>
</div>
<p>We can see that the exposure group differs slightly from the unweighted table, however the control group varies a lot, making it similar to the exposure group.</p>
</div>
<div id="exercise-6" class="section level2">
<h2>Exercise 6</h2>
<pre class="r"><code>coffee_df_ps2 &lt;- coffee_df_ps1 %&gt;%
  tidyr::pivot_wider(names_from = coffee_town, 
                     values_from = .fitted, 
                     names_prefix = &quot;coffee_town_p&quot;)</code></pre>
<pre class="r"><code>ggplot(coffee_df_ps2) +
  geom_histogram(bins = 50, 
                 aes(x = coffee_town_p1, 
                     weight = w_ato), 
                 fill = &quot;cornflower blue&quot;) +
  geom_histogram(bins = 50, 
                 aes(x = coffee_town_p0, 
                     weight = w_ato,
                     y = - stat(count)), 
                 fill = &quot;orange&quot;) + 
  scale_y_continuous(&quot;count&quot;, label = abs) + 
  scale_x_continuous(&quot;propensity score&quot;) +
  geom_label(
    label = &quot;Live in Coffee Town&quot;, 
    x = 0.25,
    y = 10,
  ) + 
  geom_label(
    label = &quot;Doesn&#39;t Live in Coffee Town&quot;,
    x = 0.25, 
    y = -10
  ) + 
  theme_minimal()</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>After weighted, these two groups have a similar distribution of propensity scores. But in the control group, we can see that some observations are lying between [0.4, 0.6], and no observations lay in this range. We may need a better propensity score model.</p>
</div>
<div id="exercise-7" class="section level2">
<h2>Exercise 7</h2>
<pre class="r"><code>smds &lt;- coffee_df_ps1 %&gt;% 
  summarise( 
    across( 
      c(
      age,
      job,
      smoke
    ), 
      list(
        unweighted = ~smd(.x, coffee_town)$estimate,
        weighted = ~smd(.x, coffee_town, w_ato)$estimate 
      )
    )
  )</code></pre>
<pre class="r"><code>plot_df &lt;- smds %&gt;% 
  pivot_longer( 
    everything(),
    values_to = &quot;SMD&quot;, 
    names_to = c(&quot;variable&quot;, &quot;Method&quot;), 
    names_pattern = &quot;(.*)_(.*)&quot;
  )</code></pre>
<pre class="r"><code>ggplot(
  data = plot_df,
  aes(x = abs(SMD), y = variable, 
      group = Method, color = Method)
) +  
  geom_line(orientation = &quot;y&quot;) +
  geom_point() + 
  geom_vline(xintercept = 0.1, 
             color = &quot;black&quot;, size = 0.1)</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>For unweighted data, the variable ‘job’ has very high SMD, ‘smoke’ and ‘age’ have similar SMD. After weighted, all three variables has similar small SMD.</p>
</div>
<div id="exercise-8" class="section level2">
<h2>Exercise 8</h2>
<p>Unweighted eCDF</p>
<pre class="r"><code>ggplot(coffee_df_ps1, 
       aes(x = age, group = coffee_town, 
           color = factor(coffee_town))) +
  stat_ecdf() +
  scale_color_manual(&quot;Live in Coffee Town&quot;, 
                     values = c(&quot;#5154B8&quot;, &quot;#5DB854&quot;),
                     labels = c(&quot;No&quot;, &quot;Yes&quot;)) + 
  scale_x_continuous(&quot;Age&quot;) + 
  ylab(&quot;Proportion&quot;)</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Based on the plot, we can see that,<br />
About 50% of the people who live in Coffee Town are less than 50 years old.<br />
About 50% of people who do not live in Coffee Town are less than 37 years old.<br />
The proportion of people live in Coffee Town from &lt;20 to &lt;40 stays the same. Most people in Coffee Town are younger than 20 or older than 40.<br />
The distribution of age in each group is very different.</p>
<pre class="r"><code>ecdf_1 &lt;- coffee_df_ps1 %&gt;%
  filter(coffee_town == 1) %&gt;%
  arrange(age) %&gt;%
  mutate(cum_pct = cumsum(w_ato) / sum(w_ato))
ecdf_0 &lt;- coffee_df_ps1 %&gt;%
  filter(coffee_town == 0) %&gt;%
  arrange(age) %&gt;%
  mutate(cum_pct = cumsum(w_ato) / sum(w_ato))

ggplot(ecdf_1, aes(x = age, y = cum_pct)) +
  geom_line(color = &quot;#5DB854&quot;) +
  geom_line(data = ecdf_0, 
            aes(x = age, y = cum_pct), 
            color = &quot;#5154B8&quot;) + 
  xlab(&quot;Age&quot;) + 
  ylab(&quot;Proportion&quot;)</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>After weighted, it makes the plot of the two groups a little bit close, but still not good. I’m going to refit the propensity score model to see if it can make it better.</p>
</div>
<div id="exercise-9" class="section level2">
<h2>Exercise 9</h2>
<pre class="r"><code>coffee_df_ps1 &lt;- glm(coffee_town ~ splines::ns(age, 3) + smoke + job,
    data = coffee_df,
    family = binomial()) %&gt;%
  augment(type.predict = &quot;response&quot;,
          data = coffee_df)%&gt;%
  mutate(w_ato = (1-.fitted)*coffee_town +.fitted*(1-coffee_town))</code></pre>
<p>weighted eCDF</p>
<pre class="r"><code>ecdf_1 &lt;- coffee_df_ps1 %&gt;%
  filter(coffee_town == 1) %&gt;%
  arrange(age) %&gt;%
  mutate(cum_pct = cumsum(w_ato) / sum(w_ato))
ecdf_0 &lt;- coffee_df_ps1 %&gt;%
  filter(coffee_town == 0) %&gt;%
  arrange(age) %&gt;%
  mutate(cum_pct = cumsum(w_ato) / sum(w_ato))

ggplot(ecdf_1, aes(x = age, y = cum_pct)) +
  geom_line(color = &quot;#5DB854&quot;) +
  geom_line(data = ecdf_0, 
            aes(x = age, y = cum_pct), 
            color = &quot;#5154B8&quot;) + 
  xlab(&quot;Age&quot;) + 
  ylab(&quot;Proportion&quot;)</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>We can see that the plot of two groups are very close to each other. It is much better.</p>
<p>SMD and Love Plot</p>
<pre class="r"><code>smds &lt;- coffee_df_ps1 %&gt;% 
  summarise( 
    across( 
      c(
      age,
      job,
      smoke
    ), 
      list(
        unweighted = ~smd(.x, coffee_town)$estimate,
        weighted = ~smd(.x, coffee_town, w_ato)$estimate 
      )
    )
  )</code></pre>
<pre class="r"><code>plot_df &lt;- smds %&gt;% 
  pivot_longer( 
    everything(),
    values_to = &quot;SMD&quot;, 
    names_to = c(&quot;variable&quot;, &quot;Method&quot;), 
    names_pattern = &quot;(.*)_(.*)&quot;
  )</code></pre>
<pre class="r"><code>ggplot(
  data = plot_df,
  aes(x = abs(SMD), y = variable, 
      group = Method, color = Method)
) +  
  geom_line(orientation = &quot;y&quot;) +
  geom_point() + 
  geom_vline(xintercept = 0.1, 
             color = &quot;black&quot;, size = 0.1)</code></pre>
<p><img src="analysis_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>The love plot is also good, I will choose this model as my final model.</p>
</div>
<div id="exercise-10" class="section level2">
<h2>Exercise 10</h2>
<pre class="r"><code>coffee_df_ps1 %&gt;%
  summarise(ato_effect = sum(cups_of_coffee * coffee_town * w_ato)/sum(coffee_town * w_ato) - 
             sum(cups_of_coffee * (1-coffee_town) * w_ato)/sum((1-coffee_town) * w_ato))</code></pre>
<pre><code>## # A tibble: 1 × 1
##   ato_effect
##        &lt;dbl&gt;
## 1   -0.00685</code></pre>
<p>For the population of individuals who reasonably could live in either town, the people in the coffee town buy 0.0068 fewer coffee than those in a neighboring town. But the difference is relatively small. To better estimate the average causal effect, we may use bootstrap. For example, running 1000 iterations, compute the average causal effect for each iteration, then take their mean. This way may give us a better estimate of the average causal effect.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
